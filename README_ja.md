# mktotp

多要素認証(2FA)用のシンプルなCUIベースのTOTPシークレット管理ツールとローカルMCPサーバ

[English](README.md) | 日本語

<!-- TOC tocDepth:2..3 chapterDepth:2..6 -->

- [1. 概要](#1-概要)
- [2. 機能](#2-機能)
- [3. 実行環境](#3-実行環境)
- [4. インストール/使用方法](#4-インストール使用方法)
- [5. MCPサーバとして登録する](#5-mcpサーバとして登録する)
- [6. CUIツールのコマンドオプション](#6-cuiツールのコマンドオプション)
  - [6-1. 共通オプション](#6-1-共通オプション)
  - [6-2. `add` コマンド](#6-2-add-コマンド)
  - [6-3. `get` コマンド](#6-3-get-コマンド)
  - [6-4. `list` コマンド](#6-4-list-コマンド)
  - [6-5. `remove` コマンド](#6-5-remove-コマンド)
  - [6-6. `rename` コマンド](#6-6-rename-コマンド)
  - [6-7. `mcp` コマンド](#6-7-mcp-コマンド)
- [7. ファイル保存場所](#7-ファイル保存場所)
- [8. セキュリティに関する注意](#8-セキュリティに関する注意)
- [9. ライセンス](#9-ライセンス)

<!-- /TOC -->

## 1. 概要

mktotp は、TOTP（時間ベースのワンタイムパスワード）シークレットを管理し、
二要素認証サービス用の認証トークンを生成するコマンドラインツールです。  
ローカルMCPサーバとしても機能し、一般的なAgentツールを使用して操作することができます。

## 2. 機能

- QR コード画像ファイルを使って TOTP シークレットを登録
  (QR コード画像は、PNG, JPEG, BMP, TIFF, SVG 形式に対応)
- 登録されたシークレットの TOTP トークンを生成
- 登録されたすべてのシークレットを一覧表示
- シークレットの削除と名前変更
- ローカル MCP サーバとして一般的なAgentツールから操作することが可能.  
  (もちろん、MCPサーバ動作時はシークレット文字列がLLMに送信されないように配慮しています)  

## 3. 実行環境

このプロジェクトはパッケージマネージャにuvを使用しています。  

uvのインストールはこちら.

- [Installing uv](https://docs.astral.sh/uv/getting-started/installation/)

## 4. インストール/使用方法

uv環境にインストールして使用します.  

```bash
# gitリポジトリから直接インストール
uv tool install git+{リポジトリのURL}
```

インストール後は、toolとして `mktotp` コマンドを直接使用できます.  

```bash
mktotp --help
```

## 5. MCPサーバとして登録する

MCPサーバとして登録することで、一般的なAgentツールからmktotpを操作することができます.  
MCPサーバの登録手順については、使用するAgentツールのマニュアルを参照してください.  

```json
{
  // MCPサーバとして登録する場合の設定例
  //
  // (注意) 
  // Agentツールによって登録キーが異なります.
  // 詳細な手順は使用するAgentツールのマニュアルを参照してください.
  "mcpServers" {
    // uvを使用してmktotpをMCPサーバとして起動する設定
    "mktotp-uv": {
      "type": "stdio",
      "command": "mktotp",
      "args": [
          "mcp",
          "--mcp-server"
      ],
      "env": {},
    }
  }
}
```

## 6. CUIツールのコマンドオプション

### 6-1. 共通オプション

- `-v, --verbose LEVEL`: 出力情報詳細レベルを設定（0: 通常、1: 詳細、2: デバッグ）
- `-s, --secrets-file FILE`: シークレットを保存する JSON ファイルのパス

### 6-2. `add` コマンド

#### 6-2-1. QRコード画像ファイルから追加

QR コード画像から新しいシークレットを追加します.  

```bash
mktotp add -nn <新しい名前> -f <QRコードイメージファイル>
```

- `-nn, --new-name`: シークレットの新しい名前（必須）
- `-f, --file`: QR コードデータを含むファイルのパス（必須）

#### 6-2-2. シークレットを直接登録 (CUIツールのみ)

シークレット文字列を直接指定して新しいシークレットを追加します.  

```bash
mktotp add -nn <新しい名前> -ss <シークレット文字列>
```

### 6-3. `get` コマンド

指定されたシークレット名の TOTP トークンを生成します。

```bash
mktotp get -n <シークレット名>
```

- `-n, --name`: 操作対象のシークレット名（必須）

### 6-4. `list` コマンド

登録されているすべてのシークレットを表示します。

```bash
mktotp list
```

### 6-5. `remove` コマンド

指定されたシークレットを削除します。

```bash
mktotp remove -n <シークレット名>
```

- `-n, --name`: 削除するシークレット名（必須）

### 6-6. `rename` コマンド

シークレットの名前を変更します。

```bash
mktotp rename -n <現在の名前> -nn <新しい名前>
```

- `-n, --name`: 現在のシークレット名（必須）
- `-nn, --new-name`: 新しいシークレット名（必須）

### 6-7. `mcp` コマンド

モジュールをローカルMCPサーバとして起動します。  
Agentツールを使用してmktotpを操作することができます。

```bash
mktotp mcp --mcp-server
```

`--mcp-server` オプションを指定しない場合は、MCPのtool一覧を出力します。

```bash
mktotp mcp
```

## 7. ファイル保存場所

デフォルトでは、シークレットは以下の場所に保存されます：

```text
~/.mktotp/data/secrets.json
```

`-s` オプションで別の場所を指定することもできます。

## 8. セキュリティに関する注意

- シークレットファイルは機密情報を含むため、適切な権限設定で保護してください。  
- バックアップを作成する際は、暗号化されたストレージを使用することを推奨します。  
- 不要になったシークレットは `remove` コマンドで削除してください。

## 9. ライセンス

このプロジェクトはMITライセンスの下で公開されています。  
詳細は [LICENSE](LICENSE) ファイルをご覧ください。
